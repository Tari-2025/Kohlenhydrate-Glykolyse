<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini‑Sim: Hexokinase / Glukokinase – Glukose → G6P (ATP‑Verbrauch)</title>
  <style>
    :root{--bg:#0f172a;--panel:#111827;--muted:#94a3b8;--ok:#16a34a;--bad:#dc2626;--accent:#22d3ee}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,sans-serif;background:radial-gradient(1200px 600px at 80% -10%,#10233d,transparent),linear-gradient(180deg,#020617,#0b1220 50%,#020617);color:#e5e7eb;min-height:100vh}
    header{padding:24px 16px 8px;text-align:center}
    h1{margin:0;font-size:clamp(20px,3vw,28px)}
    p.sub{margin:.35rem 0 0;color:var(--muted)}
    .app{max-width:980px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:980px){.grid{grid-template-columns:1fr 360px}}
    .card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.3)}
    .panel{padding:16px 16px 18px}
    .card h2{margin:0 0 8px;font-size:18px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .row3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .controls{display:grid;gap:10px}
    label{font-size:13px;color:#cbd5e1}
    .ctrl{background:linear-gradient(180deg,#0e1a2d,#0a1322);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:10px}
    .pill{font-size:12px;color:#94a3b8;padding:6px 10px;border-radius:999px;background:#0b1a30;border:1px solid rgba(255,255,255,.06)}
    .stat{display:flex;gap:8px;flex-wrap:wrap}
    .barWrap{height:12px;background:#0b1322;border:1px solid rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#22d3ee,#38bdf8)}
    .btn{border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,#0e1a2d,#0a1322);padding:10px 12px;border-radius:12px;color:#e5e7eb;cursor:pointer;font-weight:600}
    .btn:hover{border-color:rgba(255,255,255,.25)}
    .btn.green{background:linear-gradient(180deg,#0f2d1a,#0a1f15);border-color:rgba(34,197,94,.4)}
    .btn.red{background:linear-gradient(180deg,#2d0f10,#1a0a0a);border-color:rgba(239,68,68,.4)}
    .hint{font-size:13px;color:#9ca3af;margin-top:8px}
    .flex{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .tag{font-size:12px;color:#cbd5e1;background:#0b1930;border:1px solid rgba(255,255,255,.08);padding:4px 8px;border-radius:999px}
    .tests{position:fixed;left:12px;top:12px;background:rgba(2,6,23,.78);color:#cbd5e1;padding:8px 10px;border-radius:12px;border:1px solid rgba(255,255,255,.12);font-size:12px;max-width:55vw;z-index:5}
    .ok{color:#86efac}.fail{color:#fecaca}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
  </style>
</head>
<body>
  <header>
    <h1>Mini‑Simulation: Hexokinase / Glukokinase</h1>
    <p class="sub">Glukose → Glukose‑6‑phosphat (G6P) mit <b>ATP‑Verbrauch</b>, <b>Feedback‑Hemmung</b> (G6P) und <b>hormoneller Steuerung</b>.</p>
  </header>
  <main class="app">
    <div class="grid">
      <section class="card panel">
        <h2>Reaktor</h2>
        <div class="controls">
          <div class="row">
            <div class="ctrl">
              <label>Enzym</label>
              <div class="flex">
                <select id="enzyme">
                  <option value="HK">Hexokinase (Muskel)</option>
                  <option value="GK">Glukokinase (Leber)</option>
                </select>
                <span class="tag" id="modeTag">HK: G6P‑Feedback aktiv</span>
              </div>
              <div class="hint">HK: hohe Affinität, Produkthemmung durch G6P • GK: keine G6P‑Hemmung; bei F6P↑ via GKRP gehemmt.</div>
            </div>
            <div class="ctrl">
              <label>Glukose (mM)</label>
              <input id="glucose" type="range" min="0" max="20" step="0.5" value="5" />
              <div class="flex"><span class="pill">Wert: <b id="glcVal">5.0</b> mM</span><span class="pill">Km HK≈0.05 • GK≈8</span></div>
            </div>
          </div>
          <div class="row">
            <div class="ctrl">
              <label>ATP‑Pool</label>
              <div class="barWrap"><div id="barATP" class="bar"></div></div>
              <div class="stat mono"><span>ATP: <b id="ATP">50</b></span><span>ADP: <b id="ADP">0</b></span><span>Gesamt‑Umsätze: <b id="turns">0</b></span></div>
            </div>
            <div class="ctrl">
              <label>G6P‑Pool & Abfluss</label>
              <div class="barWrap"><div id="barG6P" class="bar" style="background:linear-gradient(90deg,#22c55e,#4ade80)"></div></div>
              <div class="flex mono">
                <span>G6P: <b id="G6P">0</b></span>
                <label><input type="checkbox" id="drainOn"> Abfluss an (Glykolyse/Glykogen)</label>
                <span class="pill">Rate: <b id="drainRateLabel">1</b>/Tick</span>
              </div>
            </div>
          </div>
          <div class="row3">
            <div class="ctrl">
              <label>Hormonell</label>
              <div class="flex">
                <label><input type="checkbox" id="insulinOn"> Insulin ↑</label>
                <label><input type="checkbox" id="glucagonOn"> Glukagon ↑</label>
              </div>
              <div class="hint">Insulin: senkt GKRP‑Hemmung, erhöht Abfluss • Glukagon: aktiviert GKRP (F6P‑Effekt simuliert).</div>
            </div>
            <div class="ctrl">
              <label>GKRP (nur Leber)</label>
              <div class="flex">
                <label><input type="checkbox" id="f6pHigh"> F6P hoch (GKRP aktiv)</label>
              </div>
              <div class="hint">F6P↑ → GKRP bindet GK in den Zellkern → <b>GK gehemmt</b>. Fruktose‑1‑P hebt Hemmung.</div>
            </div>
            <div class="ctrl">
              <label>Steuerung</label>
              <div class="flex">
                <button class="btn green" id="tick">Einzeltick (1 Reaktionsschritt)</button>
                <button class="btn" id="toggleAuto">▶︎ Auto</button>
                <button class="btn red" id="reset">Reset</button>
              </div>
              <div class="hint">Jeder Tick: 1 ATP → ADP, 1 Glukose → 1 G6P (wenn Enzym aktiv). Rate hängt von Glukose, Enzym & Hemmung ab.</div>
            </div>
          </div>
        </div>
      </section>

      <aside class="card panel">
        <h2>Didaktik & Erklärung</h2>
        <ul>
          <li><b>Hexokinase (HK)</b>: hohe Affinität (Km niedrig), <b>Produkthemmung durch G6P</b>.</li>
          <li><b>Glukokinase (GK)</b> (Leber): niedrige Affinität (Km hoch), <b>keine G6P‑Hemmung</b>; bei <b>F6P↑</b> via <b>GKRP</b> gehemmt, <b>Insulin</b> enthemmt (vereinfacht).</li>
          <li><b>Insulin</b> steigert die Nutzung von G6P (Abfluss) – mehr Glykolyse/Glykogensynthese.</li>
        </ul>
        <p class="hint">Vereinfachtes Modell: Michaelis‑Menten‑ähnliche Aktivität pro Tick, ganzzahlige Pools. Ziel: relative Effekte sichtbar machen.</p>
        <div class="tests" id="tests">Lade …</div>
      </aside>
    </div>
  </main>

  <script>
    // ====== Zustand ======
    let enzyme = 'HK'; // HK | GK
    let glucose = 5;   // mM (nur Einfluss auf Rate)
    let ATP=50, ADP=0, G6P=0, turns=0;
    let auto=false; let rafId=null; let acc=0; // accumulator für Timing

    const el = id=>document.getElementById(id);
    const eEnzyme = el('enzyme');
    const eGlucose = el('glucose'); const eGlcVal = el('glcVal');
    const eATP=el('ATP'), eADP=el('ADP'), eTurns=el('turns');
    const eG6P=el('G6P'); const barATP=el('barATP'); const barG6P=el('barG6P');
    const eDrainOn=el('drainOn'); const eDrainRateLabel=el('drainRateLabel');
    const eIns=el('insulinOn'); const eGcg=el('glucagonOn'); const eF6P=el('f6pHigh');
    const eModeTag=el('modeTag');
    const btnTick=el('tick'); const btnAuto=el('toggleAuto'); const btnReset=el('reset');

    // ====== Parameter (vereinfachte Kinetik) ======
    const KmHK=0.05, KmGK=8.0; // mM
    const VmaxHK=4, VmaxGK=6;  // "Moleküle" pro Tick (relativ)
    const G6P_FEEDBACK_THRESHOLD=8; // ab hier HK stark gehemmt
    const DRAIN_BASE=1; // Basaler Abfluss pro Tick

    function activityRate(){
      // Michaelis‑Menten‑ähnlich: v = Vmax * [S]/(Km+[S])
      const Km = enzyme==='HK' ? KmHK : KmGK;
      const Vmax = enzyme==='HK' ? VmaxHK : VmaxGK;
      let v = Vmax * (glucose) / (Km + glucose);
      // Produkthemmung bei HK durch G6P
      if(enzyme==='HK' && G6P >= G6P_FEEDBACK_THRESHOLD) v = 0;
      // GKRP‑Hemmung: wenn GK gewählt + (F6P hoch ODER Glukagon hoch) und kein Insulin
      if(enzyme==='GK'){
        const gkrpActive = (eF6P.checked || eGcg.checked) && !eIns.checked;
        if(gkrpActive) v = 0;
      }
      // ATP limitierend
      if(ATP <= 0) v = 0;
      // diskret: wie viele ganze "Moleküle" pro Tick?
      return Math.floor(v);
    }

    function drainRate(){
      let r = DRAIN_BASE + (eIns.checked? 1:0); // Insulin erhöht Abfluss
      return r;
    }

    function render(){
      eGlcVal.textContent = glucose.toFixed(1);
      eATP.textContent = ATP; eADP.textContent = ADP; eTurns.textContent = turns; eG6P.textContent = G6P;
      barATP.style.width = Math.min(100, ATP/50*100)+'%';
      barG6P.style.width = Math.min(100, G6P/30*100)+'%';
      eDrainRateLabel.textContent = drainRate();
      eModeTag.textContent = enzyme==='HK' ? 'HK: G6P‑Feedback aktiv' : 'GK: keine G6P‑Hemmung';
      // Toggle GKRP Sichtbarkeitstext
      eF6P.parentElement.style.opacity = (enzyme==='GK')? 1 : .5;
    }

    function tick(){
      // 1) Reaktionsschritt (Glukose + ATP → G6P + ADP)
      const v = activityRate();
      if(v>0){
        const use = Math.min(v, ATP); // ATP limit
        ATP -= use; ADP += use; G6P += use; turns += use;
      }
      // 2) Abfluss (Glykolyse/Glykogen)
      if(eDrainOn.checked && G6P>0){
        const d = Math.min(G6P, drainRate());
        G6P -= d; // vereinfachte Nutzung; ADP/ATP‑Rückkopplung ignoriert
      }
      render();
    }

    function loop(ts){
      if(!auto){ rafId=null; return; }
      if(!rafId) rafId = requestAnimationFrame(loop);
      acc += 16; // ~16 ms
      if(acc>=500){ // alle 0.5s ein Tick
        acc=0; tick();
      }
      requestAnimationFrame(loop);
    }

    // ====== Events ======
    eEnzyme.addEventListener('change', ()=>{ enzyme=eEnzyme.value; render(); });
    eGlucose.addEventListener('input', ()=>{ glucose=parseFloat(eGlucose.value); render(); });
    btnTick.addEventListener('click', ()=> tick());
    btnAuto.addEventListener('click', ()=>{ auto=!auto; btnAuto.textContent = auto? '⏸︎ Stopp' : '▶︎ Auto'; if(auto && !rafId){ acc=0; requestAnimationFrame(loop); } });
    btnReset.addEventListener('click', ()=>{ ATP=50; ADP=0; G6P=0; turns=0; auto=false; btnAuto.textContent='▶︎ Auto'; render(); });

    // Hormon-/Reg‑Toggles beeinflussen sofort die Rate
    [eDrainOn,eIns,eGcg,eF6P].forEach(c=> c.addEventListener('change', render));

    // ====== Selbsttests ======
    function tests(){
      const out=[]; const ok=s=>out.push(`<span class=ok>✔︎ ${s}</span>`); const fail=(s,m='')=>out.push(`<span class=fail>✘ ${s} ${m}</span>`);
      try{
        // Test 1: HK wird durch G6P gehemmt
        enzyme='HK'; ATP=50; ADP=0; G6P=G6P_FEEDBACK_THRESHOLD; glucose=10; const vHK=activityRate(); (vHK===0)? ok('HK: G6P‑Feedback hemmt') : fail('HK: G6P‑Feedback hemmt nicht', `v=${vHK}`);
        // Test 2: GK nicht durch G6P gehemmt
        enzyme='GK'; ATP=50; G6P=G6P_FEEDBACK_THRESHOLD; glucose=10; const vGK=activityRate(); (vGK>0)? ok('GK: keine G6P‑Hemmung') : fail('GK: fälschlich gehemmt', `v=${vGK}`);
        // Test 3: GKRP hemmt GK bei F6P hoch (ohne Insulin)
        eF6P.checked=true; eIns.checked=false; const vGK2=activityRate(); (vGK2===0)? ok('GKRP: hemmt GK bei F6P↑') : fail('GKRP: Hemmung fehlend', `v=${vGK2}`);
        // Test 4: Insulin hebt GKRP‑Hemmung auf
        eIns.checked=true; const vGK3=activityRate(); (vGK3>0)? ok('Insulin: enthemmt GK') : fail('Insulin: enthemmt nicht', `v=${vGK3}`);
        // Wieder Startwerte
        enzyme=eEnzyme.value='HK'; ATP=50; ADP=0; G6P=0; glucose=parseFloat(eGlucose.value=5);
      }catch(e){ fail('Unerwarteter Fehler', e.message); }
      el('tests').innerHTML='<b>Tests</b><br>'+out.join('<br>');
    }

    // Init
    render(); tests();
  </script>
</body>
</html>
